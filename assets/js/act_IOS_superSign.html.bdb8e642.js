"use strict";(self.webpackChunkx_blog=self.webpackChunkx_blog||[]).push([[7941],{2968:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>h});var n=a(641);const l={},t=(0,a(6262).A)(l,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,s[0]||(s[0]=[(0,n.Fv)('<h2 id="超级签名管理端接口" tabindex="-1"><a class="header-anchor" href="#超级签名管理端接口"><span>超级签名管理端接口</span></a></h2><pre><code>主要针对 苹果账号初始化接口 和 上传app接口分析\n</code></pre><h2 id="initappleaccount" tabindex="-1"><a class="header-anchor" href="#initappleaccount"><span><mark>initAppleAccount</mark></span></a></h2><pre><code>账号入库，及初始化账号\n接口：/initAppleAccount\n1.参数：sysUserId\n2.参数：appleAccountId\n</code></pre><ul><li>删除/opt/crt/* 所有文件</li><li>执行 ruby /opt/ruby/<a href="#initRb">initcrt.rb</a></li><li>参数1：账号</li><li>参数2：密码</li><li>参数3：账号</li><li>参数4：电话号码</li><li>返回字符串 包含success 及初始化成功，否则失败根据原因设置状态值 <ul><li>将本地p12文件上传至阿里云</li><li>与用户端服务器同步文件</li></ul></li></ul><hr><h2 id="uploadapp" tabindex="-1"><a class="header-anchor" href="#uploadapp"><span><mark>uploadApp</mark></span></a></h2><pre><code>上传包\n</code></pre><ul><li>系统账号状态判断</li><li>上传logo图片至阿里云</li><li>根据app语言生成mobileconfig文件</li><li>mobileconfig模板直接在代码中</li><li>执行bin/sh /opt/ruby/<a href="#signconfig">sign.sh</a></li><li>参数1 本地mobileconfig文件</li><li>参数2 签名之后的mobileconfig文件</li><li>将签名之后的mobileconfig文件上传至阿里云</li></ul><hr><h2 id="超级签名用户端接口" tabindex="-1"><a class="header-anchor" href="#超级签名用户端接口"><span>超级签名用户端接口</span></a></h2><pre><code>下载时获取uuid接口分析\n接口：/web/user/{channel}\ngetUUID函数 restful 接收channel -&gt;appName\n</code></pre><ul><li>获取请求中的流数据</li><li>解析后获取udid、手机型号</li><li>调用<mark>insertDownloandRecord</mark><ul><li>根据channel对应appName获取app信息</li><li>根据app信息进行检验，是否存在，客户是否封停，客户下载量是否足够</li><li>日志输出 当前app下载总量 app所属客户的下载总量 app当天的下载总量</li><li>判断是否下载过 <ul><li>下载过</li><li>添加点击记录</li><li>获取下载记录isUpdate，如果是0，async更新ipa： <a href="#ipa">updateIpa</a>()</li><li>async判断封号： <a href="#jc">jcAppleAccountStatus</a>()</li><li>没下载过</li><li>①加锁</li><li>②判断app状态 下载量等</li><li>③正常添加下载记录 点击记录</li><li>④签署app： async <a href="#sign">signApp</a>()</li><li>⑤添加下载记录：addAppDownloadRecord() <sup class="footnote-ref"><a href="#footnote1">[1]</a><a class="footnote-anchor" id="footnote-ref1"></a></sup></li></ul></li></ul></li><li>获取代理域名 获取member 的email如果为null 获取客户的 代理域名 <sup class="footnote-ref"><a href="#footnote2">[2]</a><a class="footnote-anchor" id="footnote-ref2"></a></sup></li><li>如果通过数据库获取的代理域名为null使用配置文件中bYurl域名</li><li>返回响应头location：代理域名/channel?udid</li></ul><hr><p><span id="ipa"></span></p><h2 id="updateipa" tabindex="-1"><a class="header-anchor" href="#updateipa"><span><mark>updateIpa</mark></span></a></h2><pre><code>异步更新ipa\n重签ipa包\n1.参数 App\n2.参数 AppDownloadRecord\n</code></pre><ul><li>获取苹果账号</li><li>执行linux命令</li><li>创建文件夹<br> /opt/app/appName/<br> /opt/app/appName/uuid/</li><li>阿里云下载.p12证书</li><li>阿里云下载.mobileprovision 描述文件</li><li>阿里云下载.ipa</li><li>开始重签 <ul><li>①解压ipa</li><li>②执行/opt/ruby/<a href="#register">register.sh</a> 脚本</li><li>参数1：解压后的ipa地址</li><li>参数2：.p12文件地址</li><li>参数3：.mobileprovision文件地址</li><li>参数4：苹果账号的证书密码</li><li>参数5：重签地址</li><li>脚本内容：<br> timeout 600 /opt/zsign/zsign -f -k <code>$2 -p $</code>4 -m <code>$3 -o $</code>5 -z 9 $1</li></ul></li><li>读取流数据 <ul><li>如果包含 Archive OK!</li><li>重新上传ipa到阿里云</li><li>修改app下载记录isUpdate为1</li><li>缓存plist文件地址</li><li>rm -rf</li><li>删除证书 ipa 描述文件 签名完的ipa</li></ul></li></ul><hr><p><span id="jc"></span></p><h2 id="jcappleaccountstatus" tabindex="-1"><a class="header-anchor" href="#jcappleaccountstatus"><span><mark>jcAppleAccountStatus</mark></span></a></h2><pre><code>异步检测苹果账号状态 检测封号\n1.参数 AppDownloadRecord\n2.参数 App\n3.参数 SystemRequest\n</code></pre><ul><li>定义苹果账号状态为0；清理缓存中的plist</li><li>获取苹果账号 <ul><li>如果数据库中没有使用 <a href="http://172.24.135.82/web/user/getAppleAccountById" target="_blank" rel="noopener noreferrer">http://172.24.135.82/web/user/getAppleAccountById</a></li><li>设置苹果账号状态为1</li><li>如果还是没有账号或者苹果账号状态为2 回调 <mark>insertDownloandRecord</mark> 函数</li><li>record重设uuid值，并修改</li></ul></li><li>执行ruby脚本 ruby /opt/ruby/<a href="#isfalse">isfalse.rb</a><ul><li>参数1：苹果账号</li><li>参数2：苹果账号密码</li><li>参数3：苹果账号手机号</li></ul></li><li>获取流数据 从而判断是否封号</li></ul><hr><p><span id="sign"></span></p><h2 id="signapp" tabindex="-1"><a class="header-anchor" href="#signapp"><span><mark>signApp</mark></span></a></h2><pre><code>异步签名方法\n1.参数： App\n2.参数： AppDownloadRecord\n3.参数： AppAcountName\n4.参数： AppAcount\n</code></pre><ul><li>检测阿里云ipa是否存在</li><li>检测账号是否有 证书是否存在</li><li>创建文件夹</li><li>下载.p12文件<br> 下载苹果账号的crt文件为p12文件</li><li>开始签名 注册到苹果 <ul><li>执行/opt/ruby/<a href="#registeruuid">registeruuid.sh</a>脚本</li><li>参数1：苹果账号</li><li>参数2：苹果账号密码</li><li>参数3：true</li><li>参数4：uuid</li><li>参数5：mobileprovision文件生成地址</li><li>参数6：mobileprovision文件名称</li><li>参数7：苹果账号手机号</li></ul></li><li>获取响应数据<br> 一系列状态判断 详情查看日志</li><li>响应数据包含success =》注册成功 <ul><li>①获取udid</li><li>②下载描述文件</li><li>③开始重签</li><li>下载ipa</li><li>执行register.sh签名</li><li>重签完成上传阿里云</li><li>生成plist文件,上传阿里云</li><li>缓存plist文件下载地址</li><li>设置苹果账号注册数 当大于等于100 设置状态为1 下线</li></ul></li></ul><hr><h2 id="相关文件说明" tabindex="-1"><a class="header-anchor" href="#相关文件说明"><span>相关文件说明</span></a></h2><pre><code>.ipa                包文件\n.mobileconfig \t    配置文件帮助用户进行app安装授权\n.p12\t\t\t\t开发证书/发布证书\n.mobileprovision \t描述文件\n.plist\t\t\t    捆绑基本信息\np12文件相当于公钥，.mobileprovision文件相当于私钥\n</code></pre><hr><p><span id="initRb"></span></p><h2 id="initcrt-rb-脚本" tabindex="-1"><a class="header-anchor" href="#initcrt-rb-脚本"><span>initcrt.rb 脚本</span></a></h2><div class="language-ruby line-numbers-mode" data-highlighter="shiki" data-ext="ruby" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ruby"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;spaceship&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require_relative </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ask_two_factor_code&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">account</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">bundleId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">phone</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">certificatid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SPACESHIP_2FA_SMS_DEFAULT_PHONE_NUMBER&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;+86 &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> store_certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">output</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cert_name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificate.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  cert_name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">#{</span><span style="--shiki-light:#50A14F;--shiki-dark:#ABB2BF;">cert_name</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.cer&quot;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> unless</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">extname</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(cert_name) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;.cer&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  path</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">expand_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output, cert_name))</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  raw_data</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificate.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">download_raw</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(path, raw_data)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> path</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> gen_random_str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#ABB2BF;--shiki-dark-font-style:italic;">len</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    rand</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">36</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> **</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> len).</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">to_s</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">36</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">login</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(account, password)</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #解析所有的证书</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  certificates</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">production</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-certificate-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificates</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-certificate-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  certificat</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificates.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">length</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;无证书&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    output</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/opt/crt/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> account</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Dir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output)</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    csr, pkey </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create_certificate_signing_request</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    certificat</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">production</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">csr</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> csr)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    private_key_path</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">expand_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(output, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">#{</span><span style="--shiki-light:#50A14F;--shiki-dark:#ABB2BF;">certificat.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span><span style="--shiki-light:#CA1243;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.key&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">))</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(private_key_path, pkey)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    store_certificate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(certificat, output)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    certificatid</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificat.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-certificate-id-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificatid</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-certificate-id-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #生成app</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    app</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    begin</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">      puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;生成app&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      app</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">bundle_id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bundleId, </span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">name</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bundleId)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    rescue</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; e</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      bundleId</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;org.&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> gen_random_str</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;.abc&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      app</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">app</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">bundle_id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bundleId, </span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">name</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> bundleId)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    app.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update_service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">app_service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">push_notification</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">on</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-app-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> app</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-app-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #判断设备</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    devices</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;判断设备&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (devices.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">length</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> &lt;=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">      Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">name</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;29403a0638ec90ff6402594a05e93ee66b43b9b8&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">udid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;29403a0638ec90ff6402594a05e93ee66b43b9b8&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      devices</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-device-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> devices.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">length</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-device-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    #创建描述文件</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;创建描述文件&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    profile</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">provisioning_profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ad_hoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">bundle_id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> app.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bundle_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">certificate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> certificat)</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-profile-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> profile.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">name</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-profile-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    profile.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">devices</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> devices</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;success&#39;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">rescue</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; e</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> e.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">message</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><span id="signconfig"></span></p><h2 id="sign-sh-脚本" tabindex="-1"><a class="header-anchor" href="#sign-sh-脚本"><span><a href="http://sign.sh" target="_blank" rel="noopener noreferrer">sign.sh</a> 脚本</span></a></h2><pre><code>使用ssl证书 ssl证书使用的是sign.quyoudu.com这个域名申请的证书\n</code></pre><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> smime</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -sign</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -in</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -out</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -signer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/ruby/2.crt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -inkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/ruby/1.key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -certfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/ruby/3.pem</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -outform</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> der</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -nodetach</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">参数</th><th style="text-align:center;">english description</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">-sign</td><td style="text-align:center;">sign message</td><td style="text-align:center;">签名消息</td></tr><tr><td style="text-align:center;">-in</td><td style="text-align:center;">input file</td><td style="text-align:center;">输入文件</td></tr><tr><td style="text-align:center;">-signer</td><td style="text-align:center;">signer certificate file</td><td style="text-align:center;">签署者证书文件</td></tr><tr><td style="text-align:center;">-inkey</td><td style="text-align:center;">input private key (if not signer or recipient)</td><td style="text-align:center;">输入私钥（如果不是签名者或收件人）</td></tr><tr><td style="text-align:center;">-certfile</td><td style="text-align:center;">other certificates file</td><td style="text-align:center;">其他证书文件</td></tr><tr><td style="text-align:center;">-outform</td><td style="text-align:center;">output format SMIME (default), PEM or DER</td><td style="text-align:center;">输出格式SMIME（默认），PEM或DER</td></tr><tr><td style="text-align:center;">-nodetach</td><td style="text-align:center;">use opaque signing</td><td style="text-align:center;">使用不透明的签名</td></tr></tbody></table><hr><p><span id="register"></span></p><h2 id="register-sh-脚本" tabindex="-1"><a class="header-anchor" href="#register-sh-脚本"><span><a href="http://register.sh" target="_blank" rel="noopener noreferrer">register.sh</a> 脚本</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">timeout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 600</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/zsign/zsign</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -k</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $2</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $4</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -m</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $3</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -z</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 9</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">参数</th><th style="text-align:center;">English description</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">-f</td><td style="text-align:center;">Force sign without cache when signing folder.</td><td style="text-align:center;">在对文件夹进行签名时强制执行不带缓存的签名。</td></tr><tr><td style="text-align:center;">-k</td><td style="text-align:center;">Path to private key or p12 file. (PEM or DER format)</td><td style="text-align:center;">私钥或p12文件的路径。 （PEM或DER格式）</td></tr><tr><td style="text-align:center;">-p</td><td style="text-align:center;">Password for private key or p12 file.</td><td style="text-align:center;">私钥或p12文件的密码。</td></tr><tr><td style="text-align:center;">-m</td><td style="text-align:center;">Path to mobile provisioning profile.</td><td style="text-align:center;">移动资源配置文件的路径。</td></tr><tr><td style="text-align:center;">-o</td><td style="text-align:center;">Path to output ipa file.</td><td style="text-align:center;">输出ipa文件的路径。</td></tr><tr><td style="text-align:center;">-z</td><td style="text-align:center;">Compressed level when output the ipa file. (0-9)</td><td style="text-align:center;">输出ipa文件时的压缩级别。 （0-9）</td></tr></tbody></table><hr><p><span id="registeruuid"></span></p><h2 id="registeruuid-sh-脚本" tabindex="-1"><a class="header-anchor" href="#registeruuid-sh-脚本"><span><a href="http://registeruuid.sh" target="_blank" rel="noopener noreferrer">registeruuid.sh</a> 脚本</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">timeout</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 180</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ruby</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /opt/ruby/registeruuid.rb</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $1</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $2</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $3</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $4</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $5</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $6</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $7</span><span style="--shiki-light:#383A42;--shiki-light-font-style:inherit;--shiki-dark:#E06C75;--shiki-dark-font-style:italic;"> $8</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">例：</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;"><a href="http://registeruuid.sh" target="_blank" rel="noopener noreferrer">registeruuid.sh</a> parameter</th><th style="text-align:center;">registeruuid.rb parameter</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">$1</td><td style="text-align:center;">ARGV[0]</td><td style="text-align:center;">苹果账号</td></tr><tr><td style="text-align:center;">$2</td><td style="text-align:center;">ARGV[1]</td><td style="text-align:center;">苹果账号密码</td></tr><tr><td style="text-align:center;">$3</td><td style="text-align:center;">ARGV[2]</td><td style="text-align:center;">true</td></tr><tr><td style="text-align:center;">$4</td><td style="text-align:center;">ARGV[3]</td><td style="text-align:center;">udid</td></tr><tr><td style="text-align:center;">$5</td><td style="text-align:center;">ARGV[4]</td><td style="text-align:center;">mobileprovision文件</td></tr><tr><td style="text-align:center;">$6</td><td style="text-align:center;">ARGV[5]</td><td style="text-align:center;">p12文件</td></tr><tr><td style="text-align:center;">$7</td><td style="text-align:center;">ARGV[6]</td><td style="text-align:center;">AdHoc（）</td></tr><tr><td style="text-align:center;">$8</td><td style="text-align:center;">ARGV[7]</td><td style="text-align:center;">手机号</td></tr></tbody></table><h2 id="registeruuid-rb-脚本" tabindex="-1"><a class="header-anchor" href="#registeruuid-rb-脚本"><span>registeruuid.rb 脚本</span></a></h2><div class="language-ruby line-numbers-mode" data-highlighter="shiki" data-ext="ruby" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ruby"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;spaceship&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require_relative </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ask_two_factor_code&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">puts</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SPACESHIP_2FA_SMS_DEFAULT_PHONE_NUMBER&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;+86 &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">login</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  device</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">name</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#986801;--shiki-dark:#56B6C2;">udid</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">])</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  devices</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">device</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">provisioning_profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ad_hoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  profiles.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">each</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">|</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">devices</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> devices</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">    p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">update!</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-UDID-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> devices.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">length</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-UDID-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  downloadProfiles</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">provisioning_profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ad_hoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  downloadProfiles.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">each</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">|</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\tputs</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\tputs</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">\tname</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\tif</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> nil</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">\t\tname</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot; &quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">  ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\tend</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> name </span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">      File</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">write</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">download</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">    end</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  end</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;success&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">rescue</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; e</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> e.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">message</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><span id="isfalse"></span></p><h2 id="isfalse-rb-脚本" tabindex="-1"><a class="header-anchor" href="#isfalse-rb-脚本"><span>isfalse.rb 脚本</span></a></h2><div class="language-ruby line-numbers-mode" data-highlighter="shiki" data-ext="ruby" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ruby"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;spaceship&quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">require_relative </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;ask_two_factor_code&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">account</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">phone</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> ARGV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;SPACESHIP_2FA_SMS_DEFAULT_PHONE_NUMBER&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;+86 &#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> phone</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">begin</span></span>\n<span class="line"><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;">    Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">login</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(account, password)</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">\tdownloadProfiles</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C18401;--shiki-dark:#E5C07B;"> Spaceship</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">provisioning_profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ad_hoc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">all</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\tdownloadProfiles.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">each</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">|</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-profile-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\tputs</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">name</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-profile-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">\t\tcert</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> p</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">certificates</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">\t\tcert.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">each</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> do</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF;">|</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\t\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===begin-certificate-id-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\t\tputs</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> c.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">id</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\t\t\tputs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;===end-certificate-id-all===&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\t\tend</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">\tend</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">  puts</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;success&quot;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">rescue</span><span style="--shiki-light:#986801;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> =&gt; e</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">   puts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> e.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">message</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">end</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="可能存在的问题" tabindex="-1"><a class="header-anchor" href="#可能存在的问题"><span>可能存在的问题</span></a></h2><pre><code>点击下载 手机提示描述文件损坏\n下载安装成功 app闪退 是包的问题？\n\n签名时使用的 ssl证书是另外一台服务器的证书 此证书需要配置吗？\n下载时 mobileprovision文件是一个静态资源 此文件来源不明 不知道是如何生成的？\n\n疑问：\n1. 之前下载后提示ssl证书过期 替换了一个ssl证书 此证书是sign.quyoudu.com域名下的证书，没有配置其他的东西，不知道是不是需要配置什么\n2. 苹果更新之后 替换了oss中的mobileprovision静态资源文件，此文件是老王的朋友发给我的，此文件如何生成不知道\n\n描述文件错误 应该是config文件或者provision文件 这两个文件的问题\n    1.不知道是不是因为ssl证书问题导致 mobileconfig文件错误\n    2.由于mobileprovision文件也替换过 但不知道怎么生成此文件\n    \n解决方案 \n    描述文件错误 \n    .检查描述文件是否过期\n    描述文件无法访问服务器\n    1.检查域名是否掉案\n    2.检查域名能否正常使用\n    \n    闪退问题\n    由于ios更新可能会导致下载后app闪退\n    查看签名工具是否更新 ，将签名工具更新到最新版本\n</code></pre><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="footnote1" class="footnote-item"><p>用于数据统计和比例 <a href="#footnote-ref1" class="footnote-backref">↩︎</a></p></li><li id="footnote2" class="footnote-item"><p>获取客户的苹果账号状态，数据库都为null，如果为1，使用 <a href="https://kl.cjappmanager.xn--combYurl-nd0mz8db1bl7p86gxl2ey88bgtek29b3h1ep01y" target="_blank" rel="noopener noreferrer">https://kl.cjappmanager.com，否则使用配置文件中的bYurl</a> <a href="#footnote-ref2" class="footnote-backref">↩︎</a></p></li></ol></section>',61)]))}]]),h=JSON.parse('{"path":"/act/IOS/superSign.html","title":"ios 签名解析","lang":"zh-CN","frontmatter":{"icon":"lock","date":"2022-05-25T00:00:00.000Z","category":["IOS","签名"],"tag":["运维","签名","分析","记录","ios"],"title":"ios 签名解析","star":true,"pageview":true,"feed":false,"seo":false,"head":[]},"git":{"createdTime":1750255462000,"updatedTime":1750255462000,"contributors":[{"name":"xk","username":"xk","email":"564293991@qq.com","commits":1,"url":"https://github.com/xk"}]},"readingTime":{"minutes":7.9,"words":2371},"filePathRelative":"act/IOS/superSign.md"}')},6262:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}}}]);